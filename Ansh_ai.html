<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Jarvis Lite Web</title>
<style>
  body { background: #111; color: #0f0; font-family: Arial, sans-serif; text-align:center; padding:20px; }
  h1 { color:#0ff; }
  button { margin:5px; padding:10px 20px; font-size:16px; cursor:pointer; background:#222; color:#0f0; border:1px solid #0f0; border-radius:5px; }
  input { padding:5px; font-size:16px; width:200px; }
  #output { margin-top:15px; font-size:16px; min-height:50px; }
  #video { border:2px solid #0f0; margin-top:10px; display:none; width:480px; height:360px; }
</style>
</head>
<body>

<h1>Jarvis Lite Web</h1>

<div>
  <button id="voiceBtn">üé§ Speak Command</button>
  <button id="cameraBtn">üì∑ Start Camera</button>
  <button id="stopCamBtn">üõë Stop Camera</button>
</div>
<div style="margin-top:10px;">
  <input id="typedCmd" placeholder="Type command here" />
  <button id="sendCmd">‚ñ∂Ô∏è Send</button>
</div>

<div id="output">Jarvis ready...</div>
<video id="video" autoplay muted></video>

<!-- TensorFlow.js -->
<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs"></script>
<script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/coco-ssd"></script>

<script>
let output = document.getElementById("output");
let video = document.getElementById("video");
let model, stream;

// ------------------ Text-to-Speech ------------------
function speak(text) {
    if (!text) return;
    const utter = new SpeechSynthesisUtterance(text);
    utter.lang = 'en-US';
    speechSynthesis.speak(utter);
}

// ------------------ Voice Recognition ------------------
async function voiceCommand() {
    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
    if (!SpeechRecognition) {
        speak("Your browser does not support speech recognition.");
        return;
    }
    const recognition = new SpeechRecognition();
    recognition.lang = 'en-US';
    recognition.interimResults = false;
    recognition.maxAlternatives = 1;
    recognition.start();

    recognition.onresult = (event) => {
        const cmd = event.results[0][0].transcript.toLowerCase();
        output.innerHTML = "You said: " + cmd;
        handleCommand(cmd);
    };
    recognition.onerror = (e) => {
        speak("Voice recognition error.");
        console.error(e);
    };
}

document.getElementById("voiceBtn").onclick = voiceCommand;

// ------------------ Wikipedia Search ------------------
async function wikiSearch(query) {
    try {
        const res = await fetch(`https://en.wikipedia.org/api/rest_v1/page/summary/${encodeURIComponent(query)}`);
        const data = await res.json();
        if (data.extract) {
            speak(data.extract);
            output.innerHTML += "<br><b>Wiki:</b> " + data.extract;
        } else {
            speak("I could not find anything.");
            output.innerHTML += "<br>No results found.";
        }
    } catch (e) {
        speak("Error fetching Wikipedia.");
        console.error(e);
    }
}

// ------------------ Camera / Object Detection ------------------
async function startCamera() {
    if (!stream) {
        try {
            stream = await navigator.mediaDevices.getUserMedia({ video:true });
            video.srcObject = stream;
        } catch(e) {
            speak("Camera access denied or not found.");
            console.error(e);
            return;
        }
    }
    video.style.display = "block";
    if (!model) model = await cocoSsd.load();
    detectFrame();
}

function stopCamera() {
    if (stream) {
        stream.getTracks().forEach(track => track.stop());
        stream = null;
    }
    video.style.display = "none";
    output.innerHTML += "<br>Camera stopped.";
}

async function detectFrame() {
    if (!stream || video.paused || video.ended) return;
    const predictions = await model.detect(video);
    if (predictions.length > 0) {
        const detected = predictions.map(p => p.class).join(", ");
        output.innerHTML = "Detected: " + detected;
        speak("I see " + detected);
    }
    requestAnimationFrame(detectFrame);
}

document.getElementById("cameraBtn").onclick = startCamera;
document.getElementById("stopCamBtn").onclick = stopCamera;

// ------------------ Command Handling ------------------
async function handleCommand(cmd) {
    if (!cmd) return;

    if (cmd.includes("time")) {
        const now = new Date().toLocaleString();
        speak("The current time is " + now);
        output.innerHTML += "<br>Time: " + now;
        return;
    }

    if (cmd.startsWith("search ") || cmd.includes("who is") || cmd.includes("what is")) {
        const query = cmd.replace(/search |who is |what is /, "").trim();
        if (query) await wikiSearch(query);
        return;
    }

    if (cmd.includes("camera") || cmd.includes("detect")) {
        await startCamera();
        return;
    }

    if (cmd.includes("exit") || cmd.includes("bye")) {
        speak("Goodbye!");
        output.innerHTML += "<br>Jarvis exiting...";
        stopCamera();
        return;
    }

    speak("I heard: " + cmd + ". Try commands like search <topic>, time, or camera.");
}

// ------------------ Typed Input ------------------
document.getElementById("sendCmd").onclick = () => {
    const cmd = document.getElementById("typedCmd").value.toLowerCase();
    output.innerHTML = "Typed command: " + cmd;
    handleCommand(cmd);
    document.getElementById("typedCmd").value = "";
};

</script>
</body>
  </html>
